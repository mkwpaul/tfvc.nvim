# tfvc.nvim

tfvc.nvim is an unofficial plugin for integration of team foundation verion
control, referred to as 'tfvc' from here on.

It provides commands to check-out files from tfvc, undo changes, add
files, show status, diff pending changes, open history etc.

It also provides default keybinds for those commands (if enabled).
Tested on Windows 10/11 and TF Version 17.10.34824.3

# Requirements

This plugin depends on the TF executable bundled with Visual studio.
It also depends on you having setup an active workspace with `TF.exe workspace`.

# Setup

Ensure that the parent directory of the TF.exe is listed in your PATH variable.
You can alternatively specify the absolute path to the TF executable via the `tf_path` option during setup.

As of writing the TF.exe can be found here:
`C:/Program Files/Microsoft Visual Studio/2022/Professional/Common7/IDE/CommonExtensions/Microsoft/TeamFoundation/Team Explorer/TF.exe`
, assuming your Visual Studio installation is in its default location.

To setup tfvc.nvim run
```lua
require('tfvc').setup()`
```

"Advanced" config:
```lua
  require('tfvc').setup({
  {
    -- specify the absolute path to the TF.exe
    -- tf_path = 'D:/SomeOtherPath/2022/Professional/Common7/IDE/CommonExtensions/Microsoft/TeamFoundation/Team Explorer/TF.exe',

    -- change the default leader for the default keymappings
    -- tf_leader = '<leader>g',
    --create_default_mappings = true,
    -- sets the base url for the web interface of your tfs repository
    version_control_web_url = 'http://zesrvtfs:8080/tfs/DefaultCollection/project/_versionControl',
    -- required so that the TFHistory command can map local paths to server paths
    workfold = {
      collection = "http://zesrvtfs:8080/tfs/defaultcollection",
      localPath = "C:/Dev/",
      serverPath = "$/project",
      workspace = "default-workspace"
    }
  })
```
`version_control_web_url` and `workfold` are required for the `:TF history` command

# Commands

:TF add
- Default keybind: `<leader>ta`
- Adds the current file to TFS. 
- Non-blocking equivalent to `:!tf add "%"

:TF checkout
- Default keybind: `<leader>tc`
- Check out the current file from TFS.
- Non-blocking equivalent to `:!tf checkout "%"` 

:TF diff {version spec?}

- Default keybind: `<leader>tl` (diff with latest)
Diffs the local version of the current file with a specific server version.
The versionspec is passed directly to the `tf view command.`

Tip:
To quickly review your pending changes bevor commiting, you can use :TF diff,
`:TF status` and `:TF loadDiffs` if you've got a slow server, in combination with
the quickfix list, the `:cnext` and `cprev` commands and |CTRL-W_o| to

First, run `:TF loadDiffs` to preload all server files.
Then open the changed files in telescope with `:TF status` and press `<C-q>` to
put the files into the quickfix list.

Then you can use `:cnext` followed by |CTRL-W_o| and `:TF diff` to view and diff
the next file.

:TF history

- Default keybind: `<leader>tw`
Opens the history of the current file in a browser.
Requires the `version_control_web_url` to be set during setup.
The |tfvc.workfold| should also be setup to avoid unnecessary queries.

:TF loadDiffs [version spec]
- Default keybind: `<leader>tpd` -- [T]FVC [P]reload [D]iffs
- Preloads a specific server version of all files with pending changes.

:TF status {all/in_cwd,fresh/cached}

- Default keybind: `<leader>ts` -- [T]FVC [S]tatus

Opens the quickfix list with all checked out files.
Optional flags: `all`, `cached`, `fresh`, `in_cwd` or their initials
- `in_cwd`: only show changed files under the current working directory. (default)
- `all`: opposite of `in_cwd` 
- `fresh` ignore cache for pending changes and query from TF.exe (default)
- `cached` load pending changes from cache if availible, otherwise query fresh

:TF undo
- Default keybind: `<leader>tu`
- Undoes any pending changes in the current file.
- Non-blocking equivalent to `:!tf undo "%"`

: TF info
Default keybind: `<leader>ti`
- Default keybind: `<leader>tu`
- Shows status of the current file
- Non-blocking equivalent to `:!tf info "%"`

## Versionspec

Some commands require a file-version which can specified a number of ways.
The versionspec format is as follows (taken from the TF.exe help):

  Versionspec:
    Date/Time         D"any .NET Framework-supported format"
                      or any of the date formats of the local machine
    Changeset number  Cnnnnnn
    Label             Llabelname
    Latest version    T
    Workspace         Wworkspacename;workspaceowner


# FAQ

- `How do I check in changes`?
Run `tf checkin` outside of nvim.
It will open a gui-tool. It has usable keyboard navigation and you need to use
it if you want to associate a specfic work item with your changeset as you
check in.

- `How to I get the latest changes from the tfvc server?`
Run `tf get . /recursive /noprompt` outside of nvim.
if you have conflicts you can run `tf resolve /noprompt /auto:[strat]
to resolve them.

- `How do I view changesets or history?`
Not in nvim. The Web client is decent enough for this.

- `How do I use nvim to resolve merge conflicts?`
I don't know. You tell me, when you figure it out.
